<!DOCTYPE html>
<html>
  <!--
  Copyright (c) 2013 The Chromium Authors. All rights reserved.
  Use of this source code is governed by a BSD-style license that can be
  found in the LICENSE file.
  -->
<head>

  <title>NaCl Sample</title>

<body>
  <p>Start Chrome from a console (with a different --user-data-dir)
      and look for the print messages there</p>
  <script type="text/javascript">
var fletchModule = null;  // The global fletch module (instantiated below).

function moduleDidLoad() {
  console.log("loaded nacl module");
  fletchModule = document.getElementById('fletch');

  var request = new XMLHttpRequest();
  request.open("GET", "hello.snapshot", true);
  request.responseType = "arraybuffer";
  request.onload = function(event) {
    var arrayBuffer = request.response;
    if (arrayBuffer) {
      console.log("sending snapshot to fletch");
      fletchModule.postMessage(arrayBuffer);
    }
  };
  request.send(null);
}

function handleMessage(message_event) {
  console.log(message_event.data);
}

  </script>
  <!--
    Note: The <embed> element is wrapped inside a <div>, which has both a 'load'
    and a 'message' event listener attached.  This wrapping method is used
    instead of attaching the event listeners directly to the <embed> element to
    ensure that the listeners are active before the NaCl module 'load' event
    fires.  This also allows you to use PPB_Messaging.PostMessage() (in C) or
    pp::Instance.PostMessage() (in C++) from within the initialization code in
    your module.
    -->
  <div id="listener">
      <script type="text/javascript">
        var listener = document.getElementById('listener');
        listener.addEventListener('load', moduleDidLoad, true);
        listener.addEventListener('message', handleMessage, true);
      </script>
      <embed id="fletch"
             width=0 height=0
             src="nacl.nmf"
             type="application/x-pnacl" />
  </div>
</body>
</html>
